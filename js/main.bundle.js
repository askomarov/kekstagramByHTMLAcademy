(()=>{"use strict";const e=e=>"Escape"===e.key,t=e=>{const t=document.createElement("div");t.style.zIndex=1e3,t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.width="320px",t.style.height="auto",t.style.transform="translate(-50%, -50%)",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="tomato",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},n=document.querySelector(".big-picture"),r=n.querySelector(".big-picture__cancel"),o=n.querySelector(".social__comment-count"),s=n.querySelector(".social__comments-loader"),c=n.querySelector(".social__comments"),i=e=>e.target.classList.contains("likes-count--active")?(e.target.textContent=Number(e.target.textContent)-1,void e.target.classList.remove("likes-count--active")):(e.target.textContent=Number(e.target.textContent)+1,void e.target.classList.add("likes-count--active")),l=new DocumentFragment,a=(e,t)=>{o.innerHTML=`${e} из <span class="comments-count">${t}</span> комментариев`},d=()=>{n.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",u),s.removeEventListener("click",p),m=5},u=t=>{e(t)&&(t.preventDefault(),d())};let m=5;const v=()=>{const e=document.querySelectorAll(".social__comment");if(e.length>5){s.classList.remove("hidden"),a(m,e.length);for(let t=0;t<e.length;t++){const n=e[t];t>=m?n.classList.add("hidden"):n.classList.remove("hidden")}}e.length<=m&&(a(e.length,e.length),s.classList.add("hidden"))},p=e=>{e.preventDefault(),m+=5,v()},y=e=>{const t=document.querySelector(".pictures"),o=document.querySelector("#picture").content.querySelector(".picture"),a=document.createDocumentFragment();e.forEach((e=>{const t=o.cloneNode(!0);t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__likes").textContent=e.likes,t.querySelector(".picture__comments").textContent=e.comments.length,t.querySelector(".picture__img").alt=e.description,a.appendChild(t),t.addEventListener("click",(t=>{var o;t.preventDefault(),(e=>{const t=e.comments;0===t.length?c.innerHTML="":(t.forEach((e=>{c.innerHTML="",(e=>{const t=document.createElement("li");t.classList.add("social__comment"),t.innerHTML=`<img\n      class="social__picture"\n      src="${e.avatar}"\n      alt="${e.name}"\n      width="35" height="35">\n  <p class="social__text">${e.message}</p>`,l.appendChild(t)})(e)})),c.appendChild(l))})(e),o=e,n.querySelector(".big-picture__img > img").src=o.url,n.querySelector(".social__caption").textContent=o.description,n.querySelector(".likes-count").textContent=o.likes,n.querySelector(".comments-count").textContent=o.comments.length,n.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",u),v(),document.querySelector(".likes-count").addEventListener("click",i),s.addEventListener("click",p),r.addEventListener("click",(()=>{d()}))}))})),t.appendChild(a)},g=document.querySelector(".img-upload__preview > img"),h=(e,t,n,r,o,s)=>{e.addEventListener("click",(()=>{t.removeAttribute("disabled","disabled"),n.value==Math.abs(o)+"%"?e.setAttribute("disabled","disabled"):(e.removeAttribute("disabled","disabled"),((e,t,n)=>{const r=e.value.split("%")[0];let o=r,s=[];o=+r+t,s.push(o+"%"),e.value=s,((e,t)=>{e.style.transform=`scale(${t})`})(n,o/100)})(n,r,s))}))},f=document.querySelector(".effect-level__slider"),L=document.querySelector(".img-upload__preview > img"),S=document.querySelectorAll(".effects__radio"),q=document.querySelector(".effect-level__value"),k=document.querySelector("#upload-select-image"),E=document.querySelector("#error").content.querySelector(".error"),b=document.querySelector("main"),x=()=>{k.reset(),q.value="",L.style.filter="none",g.style.transform="",K()},w=t=>{e(t)&&(t.preventDefault(),C())},C=()=>{document.querySelector(".error").remove(),document.removeEventListener("keydown",w),document.removeEventListener("click",$)},$=e=>{null===e.target.closest(".error__inner")&&C()},D=e=>{C(),e.target.removeEventListener("click",D)},M=()=>{x(),(()=>{const e=E.cloneNode(!0);b.append(e),document.querySelector(".error__button").addEventListener("click",D),document.addEventListener("keydown",w),document.addEventListener("click",$)})()},V=document.querySelector("#success").content.querySelector(".success"),A=()=>{document.querySelector(".success").remove(),document.removeEventListener("keydown",U),document.removeEventListener("click",T)},T=e=>{null===e.target.closest(".success__inner")&&A()},U=t=>{e(t)&&(t.preventDefault(),A())},F=e=>{A(),e.target.removeEventListener("click",F)},j=()=>{x(),(()=>{const e=V.cloneNode(!0);b.append(e),document.querySelector(".success__button").addEventListener("click",F),document.addEventListener("keydown",U),document.addEventListener("click",T)})()},N=["gif","jpg","jpeg","png"],O=document.querySelector(".scale__control--value"),H=document.querySelector(".scale__control--bigger"),z=document.querySelector(".scale__control--smaller"),I=document.querySelector("#upload-file"),P=document.querySelector(".img-upload__overlay"),R=document.body,W=document.querySelector("#upload-cancel"),G=document.querySelector(".img-upload__preview > img"),B=document.querySelectorAll(".effects__radio"),J=t=>{e(t)&&(t.preventDefault(),K())},K=()=>{P.classList.add("hidden"),R.classList.remove("modal-open"),document.removeEventListener("keydown",J),I.value="",G.classList="",G.src="img/upload-default-image.jpg"},Q=()=>{I.addEventListener("change",(()=>{var e;P.classList.remove("hidden"),R.classList.add("modal-open"),document.addEventListener("keydown",J),e=f,document.querySelector(".noUi-base")||noUiSlider.create(e,{range:{min:0,max:100},start:50,format:{to:function(e){return Number.isInteger(e)?e.toFixed(0):e.toFixed(1)},from:function(e){return parseFloat(e)}}}),e.classList.add("hidden"),((e,t)=>{e.noUiSlider.on("update",((e,n,r)=>{q.value=r[n],t.classList.contains("effects__preview--chrome")&&(t.style.filter=`grayscale(${r[n]})`),t.classList.contains("effects__preview--sepia")&&(t.style.filter=`sepia(${r[n]})`),t.classList.contains("effects__preview--marvin")&&(t.style.filter=`invert(${r[n]}%)`),t.classList.contains("effects__preview--phobos")&&(t.style.filter=`blur(${r[n]}px)`),t.classList.contains("effects__preview--heat")&&(t.style.filter=`brightness(${r[n]})`)}))})(f,L),((e,t,n)=>{for(let r=0;r<t.length;r++)t[r].addEventListener("click",(t=>{"none"==t.target.value&&(n.style.filter="",e.classList.add("hidden")),"chrome"!=t.target.value&&"sepia"!=t.target.value||(e.classList.remove("hidden"),e.noUiSlider.updateOptions({range:{min:0,max:1},start:1,step:.1})),"marvin"==t.target.value&&(e.classList.remove("hidden"),e.noUiSlider.updateOptions({range:{min:0,max:100},start:100,step:1})),"phobos"!=t.target.value&&"heat"!=t.target.value||(e.classList.remove("hidden"),e.noUiSlider.updateOptions({range:{min:0,max:3},start:3,step:.1})),"heat"==t.target.value&&(e.classList.remove("hidden"),e.noUiSlider.updateOptions({range:{min:1,max:3},start:3,step:.1}))}))})(f,S,L)})),h(H,z,O,25,100,G),h(z,H,O,-25,25,G),((e,t)=>{for(let n=0;n<e.length;n++){const r=e[n];r.addEventListener("click",(()=>{1==r.checked&&(t.classList="",t.style.filter="",t.classList.add(`effects__preview--${r.value}`))}))}})(B,G),W.addEventListener("click",(()=>{K(),x()}))},X=document.querySelector(".img-upload__overlay"),Y=X.querySelector(".text__hashtags"),Z=X.querySelector(".text__description"),ee=e=>null!==e.match(/^#\w{1,19}$/),te=t=>{e(t)&&(t.preventDefault(),t.stopPropagation())},ne=document.querySelector(".img-filters"),re=document.querySelector("#filter-default"),oe=document.querySelector("#filter-random"),se=document.querySelector("#filter-discussed"),ce=()=>{document.querySelectorAll(".picture").forEach((e=>{e.remove()}))},ie=e=>{y(e),ne&&ne.classList.contains("img-filters--inactive")&&ne.classList.remove("img-filters--inactive"),(e=>{(e=>{re.addEventListener("click",_.debounce((()=>{ce(),y((e=>e.sort((function(e,t){return e.id>t.id?1:e.id<t.id?-1:0})))(e))}),500))})(e),(e=>{oe.addEventListener("click",_.debounce((()=>{ce(),y(((e,t)=>{const n=[];for(;n.length<10;){const t=e[(r=e.length,!(r<0)&&(r<0?Math.round(Math.random()*(0-r))+r:0===r?0:Math.round(Math.random()*(r-0))+0))];n.includes(t)||void 0===t||n.push(t)}var r;return n})(e))}),500))})(e),(e=>{se.addEventListener("click",_.debounce((()=>{ce(),y((e=>e.sort((function(e,t){const n=e.comments.length,r=t.comments.length;return r>n?1:r<n?-1:0})))(e))}),500))})(e)})(e)};document.addEventListener("DOMContentLoaded",(()=>{var e,n,r;n=ie,r=t,fetch("https://22.javascript.pages.academy/kekstagram/data",{method:"GET",credentials:"same-origin"}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((e=>{n(e)})).catch((e=>{r(e)})),I.addEventListener("change",(()=>{const e=I.files[0],t=e.name.toLowerCase();if(N.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{G.src=t.result})),t.readAsDataURL(e)}})),Q(),Y.addEventListener("keydown",te),Y.addEventListener("input",(()=>{!1===(e=>{if(0===e.trim().length)return Y.setCustomValidity("введите текст"),!1;const t=e.toLowerCase().split(" ").filter((e=>0!==e.length));if(t.length!==new Set(t).size)return Y.setCustomValidity("Хэштеги должны быть уникальны"),!1;if(t.length>5)return Y.setCustomValidity("Количество хэштегов не должно превышать 5"),!1;for(let e=0;e<t.length;e++){const n=t[e];if(!n.startsWith("#"))return Y.setCustomValidity("Хэштег должен начинаться с символа #"),!1;if(!ee(n))return Y.setCustomValidity("Хэштег может состоять только из букв и чисел"),!1}return Y.style.boxShadow="",Y.setCustomValidity(""),!0})(Y.value)&&(Y.style.boxShadow="inset 0 0 3px 1px red",Y.reportValidity())})),Z.addEventListener("keydown",te),Z.addEventListener("input",(()=>{Z.value.length>140?(Z.setCustomValidity("Комментарий не должен превышать 140 символов; Удалите лишние "+(Z.value.length-140)+" симв."),Z.style.boxShadow="inset 0 0 5px 3px red"):(Z.setCustomValidity(""),Z.style.boxShadow=""),Z.reportValidity()})),e="https://22.javascript.pages.academy/kekstagram",k.addEventListener("submit",(t=>{t.preventDefault(),((e,t,n,r)=>{fetch(e,{method:"POST",body:t}).then((e=>{e.ok?n():r()})).catch((e=>{r(e)}))})(e,new FormData(t.target),j,M)}))}))})();
//# sourceMappingURL=main.bundle.js.map