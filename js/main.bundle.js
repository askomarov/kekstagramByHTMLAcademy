(()=>{"use strict";const e=e=>"Escape"===e.key,t=e=>{const t=document.createElement("div");t.style.zIndex=1e3,t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.width="320px",t.style.height="auto",t.style.transform="translate(-50%, -50%)",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="tomato",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),2e3)},r=document.querySelector(".big-picture"),n=r.querySelector(".big-picture__cancel"),s=r.querySelector(".social__comment-count"),o=r.querySelector(".social__comments-loader"),c=r.querySelector(".social__comments"),i=e=>e.target.classList.contains("likes-count--active")?(e.target.textContent=Number(e.target.textContent)-1,void e.target.classList.remove("likes-count--active")):(e.target.textContent=Number(e.target.textContent)+1,void e.target.classList.add("likes-count--active")),a=new DocumentFragment,l=(e,t)=>{s.innerHTML=`${e} из <span class="comments-count">${t}</span> комментариев`},d=()=>{r.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",u),o.removeEventListener("click",p),m=5},u=t=>{e(t)&&(t.preventDefault(),d())};let m=5;const v=()=>{const e=document.querySelectorAll(".social__comment");e.length>5&&(o.classList.remove("hidden"),l(m,e.length),e.forEach(((e,t)=>{t>=m?e.classList.add("hidden"):e.classList.remove("hidden")}))),e.length<=m&&(l(e.length,e.length),o.classList.add("hidden"))},p=e=>{e.preventDefault(),m+=5,v()},y=e=>{const t=document.querySelector(".pictures"),s=document.querySelector("#picture").content.querySelector(".picture"),l=document.createDocumentFragment();e.forEach((e=>{const t=s.cloneNode(!0);t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__likes").textContent=e.likes,t.querySelector(".picture__comments").textContent=e.comments.length,t.querySelector(".picture__img").alt=e.description,l.appendChild(t),t.addEventListener("click",(t=>{var s;t.preventDefault(),e.comments.forEach((e=>{c.innerHTML="",(e=>{const t=document.createElement("li");t.classList.add("social__comment"),t.innerHTML=`<img\n      class="social__picture"\n      src="${e.avatar}"\n      alt="${e.name}"\n      width="35" height="35">\n  <p class="social__text">${e.message}</p>`,a.appendChild(t)})(e)})),c.appendChild(a),s=e,r.querySelector(".big-picture__img > img").src=s.url,r.querySelector(".social__caption").textContent=s.description,r.querySelector(".likes-count").textContent=s.likes,r.querySelector(".comments-count").textContent=s.comments.length,r.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",u),v(),document.querySelector(".likes-count").addEventListener("click",i),o.addEventListener("click",p),n.addEventListener("click",(()=>{d()}))}))})),t.appendChild(l)},g=document.querySelector(".img-upload__preview > img"),f=(e,t,r,n,s,o)=>{e.addEventListener("click",(()=>{t.removeAttribute("disabled","disabled"),r.value===Math.abs(s)+"%"?e.setAttribute("disabled","disabled"):(e.removeAttribute("disabled","disabled"),((e,t,r)=>{const n=e.value.split("%")[0];let s=n,o=[];s=+n+t,o.push(s+"%"),e.value=o,((e,t)=>{e.style.transform=`scale(${t})`})(r,s/100)})(r,n,o))}))},h={range:{min:0,max:1},start:1,step:.1},L={range:{min:0,max:100},start:100,step:1},S={range:{min:0,max:3},start:3,step:.1},k={range:{min:1,max:3},start:3,step:.1},q=document.querySelector(".img-upload__effect-level"),E=document.querySelector(".effect-level__slider"),b=document.querySelector(".img-upload__preview > img"),w=document.querySelector(".img-upload__effects"),x=document.querySelector(".effect-level__value"),C=e=>{"none"===e.target.value&&(b.style.filter="",q.classList.add("hidden")),"chrome"!==e.target.value&&"sepia"!==e.target.value||(q.classList.remove("hidden"),E.noUiSlider.updateOptions(h)),"marvin"===e.target.value&&(q.classList.remove("hidden"),E.noUiSlider.updateOptions(L)),"phobos"===e.target.value&&(q.classList.remove("hidden"),E.noUiSlider.updateOptions(S)),"heat"===e.target.value&&(q.classList.remove("hidden"),E.noUiSlider.updateOptions(k))},$=()=>{var e,t;t=E,document.querySelector(".noUi-base")||(e=>{noUiSlider.create(e,{range:{min:0,max:100},start:50,format:{to:function(e){return Number.isInteger(e)?e.toFixed(0):e.toFixed(1)},from:function(e){return parseFloat(e)}}})})(t),q.classList.add("hidden"),e=b,E.noUiSlider.on("update",((t,r,n)=>{x.value=n[r],e.classList.contains("effects__preview--chrome")&&(e.style.filter=`grayscale(${n[r]})`),e.classList.contains("effects__preview--sepia")&&(e.style.filter=`sepia(${n[r]})`),e.classList.contains("effects__preview--marvin")&&(e.style.filter=`invert(${n[r]}%)`),e.classList.contains("effects__preview--phobos")&&(e.style.filter=`blur(${n[r]}px)`),e.classList.contains("effects__preview--heat")&&(e.style.filter=`brightness(${n[r]})`)})),w.addEventListener("click",C)},D=document.querySelector("#upload-select-image"),A=document.querySelector("#error").content.querySelector(".error"),V=document.querySelector("main"),F=()=>{D.reset(),x.value="",b.style.filter="none",g.style.transform=""},M=t=>{e(t)&&(t.preventDefault(),j())},j=()=>{document.querySelector(".error").remove(),document.removeEventListener("keydown",M),document.removeEventListener("click",U)},U=e=>{null===e.target.closest(".error__inner")&&j()},T=e=>{j(),e.target.removeEventListener("click",T)},N=()=>{se(),F(),(()=>{const e=A.cloneNode(!0);V.append(e),document.querySelector(".error__button").addEventListener("click",T),document.addEventListener("keydown",M),document.addEventListener("click",U)})()},O=document.querySelector("#success").content.querySelector(".success"),I=()=>{document.querySelector(".success").remove(),document.removeEventListener("keydown",H),document.removeEventListener("click",z)},z=e=>{null===e.target.closest(".success__inner")&&I()},H=t=>{e(t)&&(t.preventDefault(),I())},P=e=>{I(),e.target.removeEventListener("click",P)},R=()=>{se(),F(),(()=>{const e=O.cloneNode(!0);V.append(e),document.querySelector(".success__button").addEventListener("click",P),document.addEventListener("keydown",H),document.addEventListener("click",z)})()},W=["gif","jpg","jpeg","png"],G="img/upload-default-image.jpg",B=document.querySelector(".scale__control--value"),J=document.querySelector(".scale__control--bigger"),K=document.querySelector(".scale__control--smaller"),Q=document.querySelector("#upload-file"),X=document.querySelector(".img-upload__overlay"),Y=document.body,Z=document.querySelector("#upload-cancel"),ee=document.querySelector(".img-upload__preview > img"),te=document.querySelectorAll(".effects__radio"),re=document.querySelectorAll(".effects__preview"),ne=t=>{e(t)&&(t.preventDefault(),se())},se=()=>{X.classList.add("hidden"),Y.classList.remove("modal-open"),document.removeEventListener("keydown",ne),Q.value="",ee.classList="",ee.src=G,re.forEach((e=>{e.style.backgroundImage=`url(${G})`})),F(),w.removeEventListener("click",C)},oe=/^#[\w,\u0400-\u04FF]{1,19}$/,ce=document.querySelector(".img-upload__overlay"),ie=ce.querySelector(".text__hashtags"),ae=ce.querySelector(".text__description"),le=t=>{e(t)&&(t.preventDefault(),t.stopPropagation())},de=document.querySelector(".img-filters"),ue=de.querySelector(".img-filters__form"),me=ue.querySelectorAll(".img-filters__button"),ve=e=>{y(e),(()=>{if(ue.addEventListener("click",(e=>{me.forEach((t=>{if(e.target===t){if(!e.target.classList.contains(".img-filters__button--active"))return e.target.classList.add("img-filters__button--active")}else t.classList.remove("img-filters__button--active")}))})),de&&de.classList.contains("img-filters--inactive"))de.classList.remove("img-filters--inactive")})(),(e=>{ue.addEventListener("click",_.debounce((t=>{((e,t)=>{if(document.querySelectorAll(".picture").forEach((e=>{e.remove()})),t.target.classList.contains("img-filters__button"))switch(t.target.id){case"filter-default":(e=>{y((e=>e.sort(((e,t)=>e.id>t.id?1:e.id<t.id?-1:0)))(e))})(e);break;case"filter-random":(e=>{y(((e,t)=>{const r=[];for(;r.length<10;){const t=e[(n=e.length-1,!(n<0)&&(n<0?Math.round(Math.random()*(0-n))+n:0===n?0:Math.round(Math.random()*(n-0))+0))];r.includes(t)||r.push(t)}var n;return r})(e))})(e);break;case"filter-discussed":(e=>{y((e=>e.sort(((e,t)=>{const r=e.comments.length,n=t.comments.length;return n>r?1:n<r?-1:0})))(e))})(e)}})(e,t)}),500))})(e)};document.addEventListener("DOMContentLoaded",(()=>{var e,r,n,s;e=ve,r=t,fetch("https://22.javascript.pages.academy/kekstagram/data",{method:"GET",credentials:"same-origin"}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((t=>{e(t)})).catch((e=>{r(e)})),Q.addEventListener("change",(()=>{(()=>{const e=Q.files[0],r=e.name.toLowerCase();if(W.some((e=>r.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{var e;ee.src=t.result,e=t.result,re.forEach((t=>{t.style.backgroundImage=`url('${e}')`})),X.classList.remove("hidden"),Y.classList.add("modal-open"),document.addEventListener("keydown",ne)})),t.readAsDataURL(e)}else t("Загрузите изобржание в формате: gif, jpg, jpeg, png")})(),$()})),f(J,K,B,25,100,ee),f(K,J,B,-25,25,ee),n=ee,te.forEach((e=>{e.addEventListener("click",(()=>{e.checked&&(n.classList="",n.style.filter="",n.classList.add(`effects__preview--${e.value}`))}))})),Z.addEventListener("click",(()=>{se()})),ie.addEventListener("keydown",le),ie.addEventListener("input",(()=>{(e=>{if(0===e.trim().length)return ie.setCustomValidity("введите текст"),!1;const t=e.toLowerCase().split(" ").filter((e=>0!==e.length));return t.length!==new Set(t).size?(ie.setCustomValidity("Хэштеги должны быть уникальны"),!1):t.length>5?(ie.setCustomValidity("Количество хэштегов не должно превышать 5"),!1):t.every((e=>e.startsWith("#")))?t.every((e=>(e=>null!==e.match(oe))(e)))?(ie.style.boxShadow="",ie.setCustomValidity(""),!0):(ie.setCustomValidity("Хэштег может состоять только из букв и чисел"),!1):(ie.setCustomValidity("Хэштег должен начинаться с символа #"),!1)})(ie.value)||(ie.style.boxShadow="inset 0 0 3px 1px red",ie.reportValidity())})),ae.addEventListener("keydown",le),ae.addEventListener("input",(()=>{ae.value.length>140?(ae.setCustomValidity("Комментарий не должен превышать 140 символов; Удалите лишние "+(ae.value.length-140)+" симв."),ae.style.boxShadow="inset 0 0 5px 3px red"):(ae.setCustomValidity(""),ae.style.boxShadow=""),ae.reportValidity()})),s="https://22.javascript.pages.academy/kekstagram",D.addEventListener("submit",(e=>{e.preventDefault(),((e,t,r,n)=>{fetch(e,{method:"POST",body:t}).then((e=>{e.ok?r():n()})).catch((e=>{n(e)}))})(s,new FormData(e.target),R,N)}))}))})();
//# sourceMappingURL=main.bundle.js.map